---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import SectionBlock from "../components/SectionBlock.astro";
import ContentCard from "../components/ContentCard.astro";
import Timeline from "../components/Timeline.astro";
import PathCard from "../components/PathCard.astro";
import ServiceCard from "../components/ServiceCard.astro";
import NewsletterEmbed from "../components/NewsletterEmbed.astro";
import Button from "../components/Button.astro";
import Container from "../components/Container.astro";

import roadmap from "../data/roadmap.json";

const allServices = await getCollection("tjenester");
const activeServices = allServices
  .filter((s) => s.data.status === "i-drift")
  .sort((a, b) => (a.data.order ?? 99) - (b.data.order ?? 99));
---

<Layout title="Hjem">
  <!-- 1. HERO -->
  <Hero>
    <span slot="title">Teknologi for folket.</span>
    <p slot="description">
      Datakollektivet er en nyoppstartet norsk ideell forening som bygger
      digital infrastruktur og tjenester for medlemmene sine. Kollektivt eid.
      Demokratisk styrt. Åpen kildekode.
    </p>
    <div slot="cta" class="flex flex-wrap gap-3">
      <Button href="/bli-medlem" variant="primary">Bli med</Button>
      <Button href="#vi-tror" variant="secondary">Hva er dette?</Button>
    </div>
  </Hero>

  <!-- 2. VI TROR -->
  <SectionBlock
    title="Vi tror"
    id="vi-tror"
    ingress="Datakollektivet er enda ikke enige om alle løsningene. Men samtlige medlemmer er enige om problemene. Og det er helt sikkert du og."
  >
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
      <ContentCard title="Teknologi gjør reell skade.">
        På samfunnet vårt. På individer. På barna våre. På demokratiet. På
        friheten vår.
      </ContentCard>
      <ContentCard title="Folk er lei.">
        Av teknologi som bedrifitifiseres. Av selskaper som ikke har noe respekt
        for menneskene som bruker tjenestene deres. At vi kontinuerlig kastes
        inn i nye og dårligere avtaler.
      </ContentCard>
      <ContentCard title="Folk ønsker tjenester som ikke brukes mot oss.">
        Forretningsmodellen til de store er å selge oppmerksomheten din. Vi vil
        ha tjenester der du er brukeren, ikke produktet.
      </ContentCard>
    </div>
  </SectionBlock>

  <!-- 3. VI MÅ BYGGE -->
  <SectionBlock
    title="Tiden er inne"
    ingress="Det har aldri vært større muligheter for å bygge det vi ønsker selv enn det er nå."
  >
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
      <ContentCard title="Prisen på å utvikle software har stupt.">
        Og det kommer til å komme mye spennende de neste årene. Vi vil lage et
        sted som kan tilrettelegge bedre for det.
      </ContentCard>
      <ContentCard title="Det har aldri vært billigere å drifte.">
        Hardware koster mindre enn noensinne*. En håndfull servere skalerer til
        hele den norske befolkningen. Grunnleggende tjenester trenger ikke koste
        deg alt.
      </ContentCard>
      <ContentCard title="Vi må bygge det vi ønsker selv.">
        Løsningen ligger i å lage alternativer — ikke i å vente på at de store
        selskapene oppfører seg. De har hatt mange sjanser.
      </ContentCard>
    </div>
  </SectionBlock>

  <!-- 4. TEKNOLOGIEN FINNES -->
  <SectionBlock
    title="Teknologien finnes"
    ingress="Det finnes noe modne og åpne alternativer, og det kommer mer. Problemet er at det er at forbeholdt de som har teknisk kompetanse å sette opp og drifte det selv. Vi ønsker å tilgjengeliggjøre det for alle."
  >
    <div class="grid md:grid-cols-3 gap-6">
      <ContentCard title="Åpen kildekode.">
        Tjenestene vi bygger på er open source. Koden kan granskes, forbedres og
        utvikles av fellesskap verden over. Ingen hemmelig proprietær kode.
      </ContentCard>
      <ContentCard title="Åpne protokoller.">
        Vi velger løsninger basert på åpne standarder. Ingen innlåsing. Du eier
        dataene dine og kan ta dem med deg.
      </ContentCard>
      <ContentCard title="Tilgjengelig for alle.">
        Du skal ikke trenge å være utvikler for å bruke åpen teknologi. Vi gjør
        oppsett, drift og vedlikehold — du bruker tjenestene.
      </ContentCard>
    </div>
  </SectionBlock>

  <!-- 5. ORGANISERT AV OSS -->
  <SectionBlock
    title="Organisasjonen formes"
    ingress="God teknologi er ikke nok. Det trengs en organisasjon som setter fellesskapet først — ikke aksjonærer."
  >
    <div class="grid md:grid-cols-3 gap-6">
      <ContentCard title="Kollektivt eid.">
        Infrastrukturen tilhører medlemmene, ikke en bedrift. Du er del av
        fellesskapet, ikke kunde.
      </ContentCard>
      <ContentCard title="Demokratisk styrt.">
        En demokratisk kontrakt mellom de som utvikler og drifter, og de som
        bruker tjenestene. Generalforsamling, åpne styremøter, deltakende
        demokrati.
      </ContentCard>
      <ContentCard title="Rettferdig.">
        Ingen aksjonærer som krever avkastning. Pengene går tilbake til
        tjenestene. Det vi bygger, bygger vi for hverandre.
      </ContentCard>
    </div>
  </SectionBlock>

  <!-- 6. HVOR VI ER -->
  <SectionBlock
    title="Hvor vi er nå"
    ingress="Datakollektivet ble stiftet i oktober 2025. Vi bygger stein for stein."
  >
    <div class="max-w-xl">
      <Timeline variant="roadmap" steps={roadmap} />
    </div>
    <p class="mt-10 text-text-muted leading-relaxed max-w-2xl">
      Det er enormt mye som gjenstår. Enormt mange spørsmål — tekniske,
      organisatoriske, demokratiske — som ikke har fått svar ennå. Det er ikke
      en svakhet. Det er hele poenget. Vi bygger dette sammen.
    </p>
  </SectionBlock>

  <!-- 7. TRE VEIER INN -->
  <SectionBlock
    title="Tre veier inn"
    ingress="Uansett om du vil forme retningen, hjelpe til å bygge, eller bare følge med — det finnes en plass for deg."
  >
    <div class="grid md:grid-cols-3 gap-6">
      <PathCard
        title="Bli medlem"
        tagline="Form retningen."
        items={[
          "Stemmerett i generalforsamlingen",
          "Innflytelse over tjenester og prioriteringer",
          "Tilgang til Loomio, Matrix og tjenester etter hvert",
          "Vær med å finne ut av hva dette skal bli",
        ]}
        href="/bli-medlem"
        ctaLabel="Les mer"
      />
      <PathCard
        title="Bygg med oss"
        tagline="Vi trenger folk som bygger."
        highlighted
        items={[
          "Konkrete tekniske utfordringer: SSO, infrastruktur, drift",
          "Åpen kildekode hele veien",
          "Kode, design, drift, innhold, juss — eller rådgivning",
          "Alle nivåer, alle mengder tid",
        ]}
        href="/bygg-med-oss"
        ctaLabel="Se hva vi trenger"
      />
      <PathCard title="Følg oss" tagline="Ikke klar ennå? Følg reisen.">
        <div class="mb-4 flex-1">
          <p class="text-sm text-text-muted mb-4">
            Nyhetsbrev og tilgang til Matrix-kanalen vår. Følg diskusjonene uten
            forpliktelser.
          </p>
        </div>
        <NewsletterEmbed compact />
      </PathCard>
    </div>
  </SectionBlock>

  <!-- 8. TJENESTER PREVIEW -->
  <SectionBlock
    title="Hva vi bygger"
    ingress="Åpen kildekode-teknologi burde ikke være forbeholdt de med teknologikompetanse. Vi drifter tjenester som gjør den tilgjengelig for alle."
  >
    <div class="grid sm:grid-cols-3 gap-4 mb-8">
      {
        activeServices.map((service) => (
          <ServiceCard
            title={service.data.title}
            description={service.data.description}
            logo={service.data.logo}
            invertLogo={service.data.invertLogo}
            status={service.data.status}
            kategori={service.data.kategori}
            variant="compact"
          />
        ))
      }
    </div>
    <p class="text-sm text-text-muted mb-6">
      Fillagring, fotolagring, dokumentbehandling, e-post, sosiale medier,
      videomøter — alt styrt av hva medlemmene ønsker.
    </p>
    <a
      href="/tjenester"
      class="text-sm text-accent hover:text-accent-hover font-medium transition-colors"
    >
      Se alle tjenester og roadmap &rarr;
    </a>
  </SectionBlock>

  <!-- 9. SISTE CTA -->
  <section class="py-20 md:py-28">
    <Container>
      <div class="max-w-2xl">
        <p class="text-xl md:text-2xl font-medium leading-relaxed mb-8">
          Datakollektivet er et forsøk på å bygge digital infrastruktur som
          tilhører folka som bruker den. Vi er i starten. Og vi trenger deg.
        </p>
        <div class="flex flex-wrap gap-3">
          <Button href="/bli-medlem" variant="primary">Bli medlem</Button>
          <Button href="/bygg-med-oss" variant="secondary">Bygg med oss</Button>
        </div>
      </div>
    </Container>
  </section>
</Layout>
