---
import Layout from '../../layouts/Layout.astro';
import HeroSecondary from '../../components/HeroSecondary.astro';
import Container from '../../components/Container.astro';
import Button from '../../components/Button.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const eventsCollection = await getCollection('events');
  return eventsCollection.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const dateStr = new Date(entry.data.date).toLocaleDateString('nb-NO', {
  day: 'numeric',
  month: 'long',
  year: 'numeric',
});

const isPast = new Date(entry.data.date) < new Date();
---

<Layout title={entry.data.title} description={entry.data.description}>
  <HeroSecondary title={entry.data.title} description={entry.data.description} />

  <section class="py-12">
    <Container>
      <div class="max-w-3xl">
        <div class="flex flex-wrap gap-4 text-sm text-text-muted mb-8 font-mono">
          <span>{dateStr}</span>
          {entry.data.location && (
            <>
              <span class="text-border-strong">/</span>
              <span>{entry.data.location}</span>
            </>
          )}
          {isPast && <span class="text-text-muted/50">(Avholdt)</span>}
        </div>

        <div class="prose">
          <Content />
        </div>

        {!isPast && (
          <div class="mt-12">
            <div class="p-6 rounded-lg bg-surface border border-border max-w-md">
              <h3 class="font-semibold text-lg mb-4">Meld deg på</h3>
              <form class="flex flex-col sm:flex-row flex-wrap gap-3" onsubmit="return false;">
              <input
                type="text"
                placeholder="Navn"
                class="w-full sm:flex-1 min-w-0 bg-base border border-border rounded px-3 py-2.5 text-sm text-text placeholder:text-text-muted/50 focus:outline-none focus:border-accent transition-colors"
              />
              <input
                type="email"
                placeholder="E-post"
                required
                class="w-full sm:flex-1 min-w-0 bg-base border border-border rounded px-3 py-2.5 text-sm text-text placeholder:text-text-muted/50 focus:outline-none focus:border-accent transition-colors"
              />
              <button
                type="submit"
                class="bg-accent text-base font-medium rounded px-5 py-2.5 text-sm hover:bg-accent-hover transition-colors shrink-0"
              >
                Meld meg på
              </button>
            </form>
            </div>
          </div>
        )}
      </div>

      <div class="max-w-3xl mt-12 pt-8 border-t border-border">
        <Button href="/events" variant="secondary" size="sm">&larr; Alle events</Button>
      </div>
    </Container>
  </section>
</Layout>
