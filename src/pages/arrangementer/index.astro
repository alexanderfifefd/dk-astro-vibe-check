---
import Layout from '../../layouts/Layout.astro';
import HeroSecondary from '../../components/HeroSecondary.astro';
import Container from '../../components/Container.astro';
import { getCollection } from 'astro:content';

const events = await getCollection('arrangementer');
const sorted = events.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
---

<Layout title="Arrangementer" description="Arrangementer fra Datakollektivet">
  <HeroSecondary>
    <span slot="title">Arrangementer</span>
    <p slot="description">
      Møter, lanseringer og samlinger — åpne og for medlemmer.
    </p>
  </HeroSecondary>

  <section class="py-12">
    <Container>
      <div class="max-w-3xl divide-y divide-border">
        {sorted.map((event) => (
          <a
            href={`/arrangementer/${event.slug}`}
            data-date={event.data.date.toISOString()}
            class="event-item flex gap-6 py-4 group transition-opacity hover:opacity-80"
          >
            <div class="text-sm font-mono text-text-muted shrink-0 w-28 pt-0.5">
              <time class="block">
                {new Date(event.data.date).toLocaleDateString('nb-NO', { day: 'numeric', month: 'short', year: 'numeric' })}
              </time>
              {event.data.location && (
                <span class="block text-xs mt-0.5">{event.data.location}</span>
              )}
            </div>
            <div>
              <h3 class="event-title font-semibold transition-colors group-hover:text-accent">
                {event.data.title}
              </h3>
              <p class="text-sm text-text-muted mt-0.5">{event.data.description}</p>
            </div>
          </a>
        ))}
      </div>
    </Container>
  </section>
</Layout>

<script>
  const now = new Date();
  document.querySelectorAll('.event-item').forEach((el) => {
    const date = new Date(el.getAttribute('data-date')!);
    if (date < now) {
      el.classList.remove('hover:opacity-80');
      el.classList.add('opacity-40', 'hover:opacity-70');
      el.querySelector('.event-title')?.classList.remove('group-hover:text-accent');
      el.querySelector('.event-title')?.classList.add('text-text-muted');
    }
  });
</script>
