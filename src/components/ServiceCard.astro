---
interface Props {
  title: string;
  description: string;
  logo?: string;
  invertLogo?: boolean;
  status: 'i-drift' | 'forslag' | 'ønskeliste' | 'påkrevd';
  kategori: 'tjeneste' | 'infrastruktur';
  driftsmodell?: string;
  url?: string;
  slug?: string;
  erstatter?: string[];
  alternativer?: string[];
  variant?: 'full' | 'compact';
}

const {
  title, description, logo, invertLogo, status, kategori,
  driftsmodell, url, slug, erstatter, alternativer, variant = 'full',
} = Astro.props;

const statusLabels: Record<string, { label: string; class: string }> = {
  'i-drift': { label: 'I drift', class: 'bg-green-500/10 text-green-400 border-green-500/20' },
  'forslag': { label: 'Forslag', class: 'bg-amber-500/10 text-amber-400 border-amber-500/20' },
  'ønskeliste': { label: 'Ønskeliste', class: 'bg-text-muted/10 text-text-muted border-border' },
  'påkrevd': { label: 'Påkrevd', class: 'bg-red-500/10 text-red-400 border-red-500/20' },
};

const statusStyle = statusLabels[status];
const isWishlist = status === 'ønskeliste';
const isInfra = kategori === 'infrastruktur';
const hasDetailPage = status === 'i-drift' || status === 'forslag';
---

{variant === 'compact' ? (
  <div class="flex items-center gap-4 p-4 bg-surface rounded-lg border border-border">
    {logo && (
      <img
        src={logo}
        alt=""
        class:list={["w-8 h-8 object-contain shrink-0", invertLogo && "invert"]}
      />
    )}
    <div class="min-w-0">
      <span class="font-medium text-sm">{title}</span>
      <p class="text-xs text-text-muted truncate">{description}</p>
    </div>
  </div>
) : (
  <div class:list={[
    "p-6 rounded-lg flex flex-col",
    isWishlist
      ? "border border-dashed border-border bg-surface/50"
      : isInfra
        ? "border border-border bg-surface/80"
        : "border border-border bg-surface",
  ]}>
    <div class="flex items-start gap-3 mb-3">
      {logo && (
        <img
          src={logo}
          alt=""
          class:list={["w-8 h-8 object-contain shrink-0 mt-0.5", invertLogo && "invert"]}
        />
      )}
      <div class="min-w-0 flex-1">
        <div class="flex items-center gap-2 flex-wrap">
          <h3 class="font-semibold">{title}</h3>
          <span class:list={["text-xs px-2 py-0.5 rounded-full border font-medium", statusStyle.class]}>
            {statusStyle.label}
          </span>
          {isInfra && (
            <span class="text-xs px-2 py-0.5 rounded-full border border-border text-text-muted font-medium">
              Infrastruktur
            </span>
          )}
        </div>
      </div>
    </div>

    <p class:list={["text-sm leading-relaxed mb-4 flex-1", isWishlist ? "text-text-muted/70" : "text-text-muted"]}>
      {description}
    </p>

    {erstatter && erstatter.length > 0 && (
      <p class="text-xs text-text-muted/60 mb-2">
        <span class="italic">Erstatter:</span> {erstatter.join(', ')}
      </p>
    )}

    {alternativer && alternativer.length > 0 && (
      <p class="text-xs text-text-muted/60 mb-3">
        <span class="italic">Alternativer:</span> {alternativer.join(' · ')}
      </p>
    )}

    {driftsmodell && (
      <p class="text-xs text-text-muted/60 mb-3">
        Driftsform: {driftsmodell}
      </p>
    )}

    <div class="flex items-center gap-4 mt-auto pt-2">
      {url && (
        <a href={url} target="_blank" rel="noopener" class="text-sm text-accent hover:text-accent-hover transition-colors">
          Åpne tjenesten &rarr;
        </a>
      )}
      {hasDetailPage && slug && (
        <a href={`/tjenester/${slug}`} class="text-sm text-text-muted hover:text-accent transition-colors">
          Les mer
        </a>
      )}
    </div>
  </div>
)}
