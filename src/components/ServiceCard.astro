---
interface Props {
  title: string;
  description: string;
  logo?: string;
  invertLogo?: boolean;
  status?: 'i-drift' | 'forslag' | 'ønskeliste';
  kategori?: 'tjeneste' | 'infrastruktur';
  driftsmodell?: string;
  url?: string;
  slug?: string;
  erstatter?: string[];
  alternativer?: string[];
  alternativerTil?: string[];
  variant?: 'full' | 'compact' | 'minimal';
}

const {
  title, description, logo, invertLogo, status, kategori,
  driftsmodell, url, slug, erstatter, alternativer, alternativerTil, variant = 'full',
} = Astro.props;

const isWishlist = status === 'ønskeliste';
const isInfra = kategori === 'infrastruktur';
const hasDetailPage = status && (status === 'i-drift' || status === 'forslag');
const altList = alternativerTil ?? erstatter ?? alternativer ?? [];

const driftsmodellLabels: Record<string, string> = {
  foreningsdriftet: 'Foreningsdriftet',
  medlemsinitiativ: 'Medlemsinitiativ',
  samarbeid: 'Samarbeid',
};

// Nøytrale farger for visuell differensiering — ingen positivitet/skala
const kategoriColors: Record<string, string> = {
  infrastruktur: 'bg-slate-500/10 text-slate-400 border-slate-500/20',
  tjeneste: 'bg-violet-500/10 text-violet-400 border-violet-500/20',
};

const driftsmodellColors: Record<string, string> = {
  foreningsdriftet: 'bg-cyan-500/10 text-cyan-400 border-cyan-500/20',
  medlemsinitiativ: 'bg-stone-500/10 text-stone-400 border-stone-500/20',
  samarbeid: 'bg-indigo-500/10 text-indigo-400 border-indigo-500/20',
};
---

{variant === 'minimal' ? (
  <div class="p-4 rounded-lg border border-dashed border-border bg-surface/50 flex flex-col">
    <div class="flex items-start gap-3 mb-2">
      {logo && (
        <img
          src={logo}
          alt=""
          class:list={["w-6 h-6 object-contain shrink-0 mt-0.5", invertLogo && "invert"]}
        />
      )}
      <div class="min-w-0 flex-1">
        <h3 class="font-medium text-sm">{title}</h3>
      </div>
    </div>
    <p class="text-xs text-text-muted/70 leading-relaxed mb-2">{description}</p>
    {altList.length > 0 && (
      <p class="text-xs text-text-muted/60">
        <span class="italic">Alternativ til:</span> {altList.join(', ')}
      </p>
    )}
  </div>
) : variant === 'compact' ? (
  <div class="flex items-center gap-4 p-4 bg-surface rounded-lg border border-border">
    {logo && (
      <img
        src={logo}
        alt=""
        class:list={["w-8 h-8 object-contain shrink-0", invertLogo && "invert"]}
      />
    )}
    <div class="min-w-0">
      <span class="font-medium text-sm">{title}</span>
      <p class="text-xs text-text-muted truncate">{description}</p>
    </div>
  </div>
) : (
  <div class:list={[
    "p-4 rounded-lg flex flex-col",
    isWishlist
      ? "border border-dashed border-border bg-surface/50"
      : isInfra
        ? "border border-border bg-surface/80"
        : "border border-border bg-surface",
  ]}>
    <div class="flex items-start gap-3 mb-2">
      {logo && (
        <img
          src={logo}
          alt=""
          class:list={["w-7 h-7 object-contain shrink-0 mt-0.5", invertLogo && "invert"]}
        />
      )}
      <div class="min-w-0 flex-1">
        <div class="flex items-center gap-2 flex-wrap">
          <h3 class="font-semibold text-sm">{title}</h3>
          {kategori && (
            <span class:list={["text-xs px-2 py-0.5 rounded-full border font-medium", kategoriColors[kategori] ?? "border-border text-text-muted"]} data-facet="kategori">
              {isInfra ? 'Infrastruktur' : 'Tjeneste'}
            </span>
          )}
          {driftsmodell && driftsmodellLabels[driftsmodell] && (
            <span class:list={["text-xs px-2 py-0.5 rounded-full border font-medium", driftsmodellColors[driftsmodell] ?? "border-border text-text-muted"]} data-facet="driftsmodell" data-driftsmodell={driftsmodell}>
              {driftsmodellLabels[driftsmodell]}
            </span>
          )}
        </div>
      </div>
    </div>

    <p class:list={["text-sm leading-relaxed mb-3 flex-1", isWishlist ? "text-text-muted/70" : "text-text-muted"]}>
      {description}
    </p>

    {altList.length > 0 && (
      <p class="text-xs text-text-muted/60 mb-2">
        <span class="italic">Alternativ til:</span> {altList.join(', ')}
      </p>
    )}

    <div class="flex items-center gap-4 mt-auto pt-2">
      {url && (
        <a href={url} target="_blank" rel="noopener" class="text-sm text-accent hover:text-accent-hover transition-colors">
          Åpne tjenesten &rarr;
        </a>
      )}
      {hasDetailPage && slug && (
        <a href={`/tjenester/${slug}`} class="text-sm text-text-muted hover:text-accent transition-colors">
          Les mer
        </a>
      )}
    </div>
  </div>
)}
